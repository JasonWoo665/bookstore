<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>happy bookstore!</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="main.js"></script>
</head>
<style>
    * {
        border-style: solid;
        background-color: blanchedalmond;
        padding: 0;
        margin: 0;
    }
    section, nav, div, aside {
        display: flex;
        align-content: stretch;
    }
    #mainShowBookArea{
        /* display: block; */
        flex-wrap: wrap;
        align-content: stretch;
    }
    .books{
        width: 20%;
    }
    .books img{
        max-width: 100%;
        display: block;
    }
</style>
<body>
    <h1>Main Page</h1>
    <section style="flex-direction: column; width: 99vw;">
        <nav style="height: 100px; justify-content: center; flex-direction: column;">
            <form action="post" style="align-self: center;">
                <input type="text" placeholder="Keyword(s)" style="float: left; width: 70vw;">
                <input type="submit" name="searching" id="searching" value="Search">
            </form>
            <div class="loginOptions" style="flex-direction: row; justify-content: flex-end;">
                <div id="loginCheckArea">
                    
                </div>
                <form action="myshoppingCartShow.html"><button type="submit">Cart</button></form>
            </div>
        </nav>
        <div class="inner" style="flex-direction: row; height: 300px;">
            <aside style="flex-direction: column;">
                <div>Category</div>
                <a onclick="filter('Storybook')">Storybook</a>
                <a onclick="filter('Contemporary Fiction')">Contemporary Fiction</a>
                <a onclick="filter('Picture Book')">Picture Book</a>
                <a onclick="filter('History')">History</a>
            </aside>
            <div id="mainShowBookWrapper" style="display: block; width: 100vw;">
                <a href="main.html">home</a>
                <h3>All Books</h3>
                <a href="main.html" style="float: right; clear: right;">sort by price</a>
                <div id="mainShowBookArea" style="clear: right">
                    <div>Book1</div>
                    <div>Book2</div>
                    <div>Book3</div>
                    <div>Book4</div>
                    <div>Book5</div>
                </div>
            </div>
        </div>
        <button onclick="testing()">testing</button>
    </section>
    <!-- <script src="main.js" language="Javascript" type="text/javascript"></script> -->
    <script>
        function filter(type){
            var xmlhttp = new XMLHttpRequest();
                
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var mainShowBookArea = document.getElementById("mainShowBookArea");
                mainShowBookArea.innerHTML = xmlhttp.responseText;
                }
            }
            xmlhttp.open("POST", "showbook.php", true);
            xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlhttp.send("show=filter&type="+type);
        }
        function showAll() {
            var xmlhttp = new XMLHttpRequest();
                
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var mainShowBookArea = document.getElementById("mainShowBookArea");
                mainShowBookArea.innerHTML = xmlhttp.responseText;
                }
            }
            xmlhttp.open("POST", "showbook.php", true);
            xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlhttp.send("show=all");
        }

        function checkLogin(){
            // check login status
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    var loginCheckArea = document.getElementById("loginCheckArea");
                    console.log(xmlhttp.responseText);
                    loginCheckArea.innerHTML = xmlhttp.responseText;
                }
            }
            xmlhttp.open("POST", "checkLoginStatus.php", true);
            xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlhttp.send("action=checklogin");
        }

        function testing(){
            // show session array
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    console.log('testing: ',xmlhttp.responseText);
                }
            }
            xmlhttp.open("POST", "verifyLogin.php", true);
            xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlhttp.send("action=testing");
        }
        window.onload = function() {
            console.log('fired');
            checkLogin();
            showAll();
        }
    </script>
</body>
</html>